<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventariado | Santis Gallego S.A.S</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-auth-compat.js"></script> 

    <style>
        :root {
            --primary-red: #830707;
            --hover-red: #FF1A1A;
            --dark-gray: #1a1a1a;
            --light-bg: #f4f4f4;
            --bg-overlay: rgba(0, 0, 0, 0.75);
        }

        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(var(--bg-overlay), var(--bg-overlay)), 
                        url('https://media.licdn.com/dms/image/v2/C4E1BAQEwhNszm6dW-Q/company-background_10000/company-background_10000/0/1613591908640/filsa_cover?e=2147483647&v=beta&t=3nbyI94DarGf84BJMd5Tyye0Gbwuj0FEXHRgUwaDlKI');
            background-size: cover;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
        }

        .screen { display: none; min-height: 100vh; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .active { display: flex; }

        .container-card {
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-width: 1350px;
            width: 95%;
            color: var(--dark-gray);
            text-align: center;
            border-top: 8px solid var(--primary-red);
        }

        .logo-main { width: 160px; margin-bottom: 15px; border-radius: 10px; }
        h1 { font-weight: 700; text-transform: uppercase; margin: 0; font-size: 26px; color: var(--dark-gray); }
        .subtitle { color: #666; margin-bottom: 30px; }

        /* Botones Principales */
        .boton {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            padding: 18px 30px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            background-color: var(--primary-red);
            color: white;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 220px;
            text-transform: uppercase;
        }

        .boton:hover {
            background-color: var(--hover-red);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        /* Botones de M√≥dulos (Dise√±o Blanco) */
        .grid-modulos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 20px;
        }

        .boton-modulo {
            display: flex;
            align-items: center;
            background: #ffffff;
            color: #1a1a1a;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            text-decoration: none;
        }

        .boton-modulo:hover {
            border-color: var(--primary-red);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .boton-modulo i {
            font-size: 40px;
            margin-right: 20px;
            font-style: normal;
        }

        .boton-modulo div b {
            display: block;
            font-size: 18px;
            text-transform: uppercase;
        }

        /* Estilos Tabla Admin */
        .table-wrapper {
            max-height: 550px;
            overflow: auto;
            margin-top: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { background: var(--dark-gray); color: white; padding: 12px; position: sticky; top: 0; z-index: 10; }
        td { padding: 5px; border-bottom: 1px solid #eee; }

        .inp-edit {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Montserrat', sans-serif;
            box-sizing: border-box;
            font-size: 12px;
        }

        .btn-save-mini {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        #iframe-container { display:none; width:100%; height:100vh; background:white; position: fixed; top:0; left:0; z-index: 100; }
        iframe { width:100%; height:100%; border:none; }
        
        .back-floating {
            position:fixed; bottom:30px; left:30px; z-index:1000;
            background: var(--dark-gray); color:white; padding:15px 35px;
            border-radius:50px; border:none; cursor:pointer; font-weight: 700;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<button id="btnVolver" class="back-floating" style="display:none;" onclick="location.reload()">üè† CERRAR SISTEMA</button>

<section id="scr-portal" class="screen active">
    <div class="container-card">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgnerOj2O8sGZ_7tfgArNSLdJk4RJECjNNsQ&s" class="logo-main">
        <h1>Sistema de Inventariado</h1>
        <p class="subtitle">FILSA M√âXICO</p>
        <div>
            <button class="boton" onclick="showScreen('scr-select-inv')">M√≥dulos de Inventario</button>
            <button class="boton" style="background:#333" onclick="showScreen('scr-login')">Administraci√≥n</button>
        </div>
    </div>
</section>

<section id="scr-select-inv" class="screen">
    <div class="container-card">
        <h1>üì¶ M√≥dulos Disponibles</h1>
        <p class="subtitle">Seleccione el √°rea que desea consultar</p>
        
        <div class="grid-modulos">
            <div class="boton-modulo" onclick="lanzarMenuSantis()">
                <i>üè¢</i>
                <div><b>L√°minas y Mallas</b><span>Stock general</span></div>
            </div>
            
            <div class="boton-modulo" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/')">
                <i>üì¶</i>
                <div><b>Cajas</b><span>Empaque y embalaje</span></div>
            </div>
            
            <div class="boton-modulo" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/BASILICA')">
                <i>‚õ™</i>
                <div><b>Bas√≠lica</b><span>Inventario sede</span></div>
            </div>
            
            <div class="boton-modulo" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/ALMACEN-GENERAL/')">
                <i>üè≠</i>
                <div><b>Almac√©n General</b><span>Materia prima</span></div>
            </div>
            
            <div class="boton-modulo" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/PRODUCTO-TERMINADO/')">
                <i>‚úÖ</i>
                <div><b>Producto Terminado</b><span>Listo para env√≠o</span></div>
            </div>
        </div>

        <button class="boton" style="margin-top:40px; background:#666;" onclick="showScreen('scr-portal')">‚¨Ö REGRESAR</button>
    </div>
</section>

<section id="scr-login" class="screen">
    <div class="container-card" style="max-width:400px;">
        <h2>Acceso Administrativo</h2>
        <input type="email" id="user-email" placeholder="Usuario" style="width:90%; padding:15px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
        <input type="password" id="user-pass" placeholder="Contrase√±a" style="width:90%; padding:15px; margin-bottom:20px; border-radius:8px; border:1px solid #ddd;">
        <button class="boton" style="width:95%" onclick="procesarLogin()">Entrar al Sistema</button>
        <button onclick="showScreen('scr-portal')" style="background:none; border:none; color:#666; cursor:pointer; margin-top:10px;">Cancelar</button>
    </div>
</section>

<section id="scr-admin-panel" class="screen">
    <div class="container-card">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:20px;">
            <h2 style="margin:0">‚öôÔ∏è Panel de Control</h2>
            <button class="boton" style="background:#222; min-width: 150px;" onclick="location.reload()">Cerrar</button>
        </div>

        <select id="select-db" onchange="conectarYMostrar()" style="width:100%; padding:15px; border-radius:10px; font-weight:bold; font-size:16px; border: 2px solid #ddd;">
            <option value="">-- Seleccione el inventario a editar --</option>
            <option value="laminas">L√°minas</option>
            <option value="mallas">Mallas</option>
            <option value="cajas">Cajas</option>
            <option value="basilica">Bas√≠lica</option>
            <option value="almacen">Almac√©n General</option>
            <option value="terminado">Producto Terminado</option>
        </select>

        <div class="table-wrapper">
            <table id="tabla-admin">
                <thead id="head-maestro"></thead>
                <tbody id="body-maestro"></tbody>
            </table>
        </div>
    </div>
</section>

<div id="iframe-container"><iframe id="filsa-frame"></iframe></div>

<script>
    const configs = {
        laminas: { apiKey: "AIzaSyAm3_glzSwxKc_B6b9F3WSMtnTbRPlz82g", databaseURL: "https://laminas-12ea7-default-rtdb.firebaseio.com", projectId: "laminas-12ea7" },
        cajas: { apiKey: "AIzaSyB8wVMIhqa9OAFJCt3bzqouip2ICtqJkNQ", databaseURL: "https://almacen-cajas-filsa-default-rtdb.firebaseio.com", projectId: "almacen-cajas-filsa" },
        basilica: {apiKey: "AIzaSyArJXmpHrZNbGz3AYRtz2pg_g-PghfxgkI", databaseURL: "https://basilica-dd3b1-default-rtdb.firebaseio.com", projectId: "basilica-c0fe0"},
        mallas: { apiKey: "AIzaSyB6Zs6aRV5YV5DoRKfRvXj-306tkAU-LMU", databaseURL: "https://mallas-ffb9b-default-rtdb.firebaseio.com", projectId: "mallas-ffb9b" },
        almacen: { apiKey: "AIzaSyByT_G8...", databaseURL: "https://almacen-general-default-rtdb.firebaseio.com", projectId: "almacen-general" },
        terminado: { apiKey: "AIzaSyD_Xy1...", databaseURL: "https://producto-terminado-default-rtdb.firebaseio.com", projectId: "producto-terminado" }
    };

    const apps = {};
    for (let key in configs) { apps[key] = firebase.initializeApp(configs[key], key); }
    const auth = firebase.auth(apps.cajas);

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        if (id !== 'none') document.getElementById(id).classList.add('active');
    }

    function procesarLogin() {
        const u = document.getElementById('user-email').value;
        const p = document.getElementById('user-pass').value;
        auth.signInWithEmailAndPassword(u, p).then(() => showScreen('scr-admin-panel')).catch(e => alert("Acceso denegado"));
    }

    function conectarYMostrar() {
        const dbKey = document.getElementById('select-db').value;
        if (!dbKey) return;
        
        firebase.database(apps[dbKey]).ref('/').on('value', snap => {
            const data = snap.val();
            const head = document.getElementById('head-maestro');
            const body = document.getElementById('body-maestro');
            body.innerHTML = "";
            head.innerHTML = "";

            if (data) {
                const columnas = ['nombre', 'cal', 'd', 'm', 'med', 'pin', 'pmm', 'stock', 'min', 'max'];
                let trHead = "<tr>";
                columnas.forEach(c => trHead += `<th>${c.toUpperCase()}</th>`);
                trHead += "<th>üíæ</th></tr>";
                head.innerHTML = trHead;
                renderRecursivo(data, "", dbKey, columnas);
            }
        });
    }

    function renderRecursivo(obj, ruta, dbKey, colArray) {
        const body = document.getElementById('body-maestro');
        for (let key in obj) {
            const item = obj[key];
            const fullPath = ruta ? `${ruta}/${key}` : key;
            if (item && typeof item === 'object') {
                if (item.stock !== undefined || item.nombre !== undefined) {
                    let tr = `<tr id="row-${fullPath.replace(/\//g,'-')}">`;
                    colArray.forEach(col => {
                        const val = item[col] !== undefined ? item[col] : "";
                        const type = (col === 'stock' || col === 'min' || col === 'max') ? 'number' : 'text';
                        tr += `<td><input type="${type}" class="inp-edit" data-col="${col}" value="${val}"></td>`;
                    });
                    tr += `<td><button class="btn-save-mini" onclick="guardarFila('${dbKey}','${fullPath}')">üíæ</button></td></tr>`;
                    body.innerHTML += tr;
                }
                renderRecursivo(item, fullPath, dbKey, colArray);
            }
        }
    }

    function guardarFila(dbKey, path) {
        const rowId = `row-${path.replace(/\//g,'-')}`;
        const inputs = document.querySelectorAll(`#${rowId} input`);
        let updateData = {};
        inputs.forEach(inp => {
            const col = inp.getAttribute('data-col');
            updateData[col] = inp.type === 'number' ? parseFloat(inp.value) : inp.value;
        });

        firebase.database(apps[dbKey]).ref(path).update(updateData).then(() => {
            alert("‚úÖ Informaci√≥n actualizada correctamente");
        });
    }

    function lanzarMenuSantis() {
        showScreen('none');
        document.getElementById('iframe-container').style.display = 'block';
        document.getElementById('btnVolver').style.display = 'block';
        const frame = document.getElementById('filsa-frame');
        const doc = frame.contentDocument || frame.contentWindow.document;
        doc.open();
        doc.write(`
            <!DOCTYPE html>
            <html lang="es">
            <head>
                <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
                <style>
                    body { background-color: #f4f4f4; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: 'Montserrat', sans-serif; color: #1a1a1a; padding: 20px; box-sizing: border-box; }
                    .container { display: flex; flex-direction: column; align-items: center; background-color: #ffffff; padding: 50px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border-top: 10px solid #830707; }
                    .logo { width: 140px; margin-bottom: 30px; border-radius: 10px; }
                    .button-group { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
                    .boton { 
                        display: flex; flex-direction: column; align-items: center; text-decoration: none; padding: 30px; 
                        background-color: white; color: #1a1a1a; border: 2px solid #eee; border-radius: 20px; 
                        transition: all 0.3s ease; min-width: 160px; text-align: center; font-weight: 700;
                    }
                    .boton:hover { border-color: #830707; transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
                    .boton span { font-size: 50px; margin-bottom: 10px; }
                </style>
            </head>
            <body>
                <div class="container">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgnerOj2O8sGZ_7tfgArNSLdJk4RJECjNNsQ&s" class="logo">
                    <h2 style="margin-top:0">Seleccione Categor√≠a</h2>
                    <div class="button-group">
                        <a href="https://santisgallegos123-rgb.github.io/laminas/" class="boton">
                            <span>üíø</span> L√°minas
                        </a>
                        <a href="https://santisgallegos123-rgb.github.io/mallas/" class="boton">
                            <span>üï∏Ô∏è</span> Mallas
                        </a>
                    </div>
                </div>
            </body>
            </html>
        `);
        doc.close();
    }

    function lanzarApp(url) {
        showScreen('none');
        document.getElementById('filsa-frame').src = url;
        document.getElementById('iframe-container').style.display = 'block';
        document.getElementById('btnVolver').style.display = 'block';
    }
</script>
</body>
</html>

