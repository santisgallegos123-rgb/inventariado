<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FILSA | inventariado</title>

    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-auth-compat.js"></script> 

    <style>
:root{
    --red:#b11226;
    --dark:#111;
    --gray:#850e1e;
    --blue:#2980b9;
    --card:#ffffff;
    --shadow:0 15px 30px rgba(0,0,0,.15);
}

*{ box-sizing:border-box; }

body{
    margin:0;
    font-family:'Segoe UI',system-ui,sans-serif;
    background:var(--gray);
    color:#222;
    overflow:hidden;
}

.screen{
    display:none;
    min-height:100vh;
    width:100%;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:20px;
}

.active{ display:flex; }

/* ---------- PORTAL ---------- */
#scr-portal h1{
    font-size:28px;
    margin:10px 0;
}

.card-container{
    display:flex;
    gap:20px;
    margin-top:30px;
    flex-wrap:wrap;
    justify-content:center;
}

.card{
    background:var(--card);
    width:180px;
    padding:25px 20px;
    border-radius:16px;
    text-align:center;
    cursor:pointer;
    box-shadow:var(--shadow);
    transition:.3s;
    border:2px solid transparent;
}

.card h1{
    font-size:40px;
    margin:0;
}

.card h3{
    margin:10px 0 0;
    letter-spacing:1px;
}

.card:hover{
    transform:translateY(-8px) scale(1.03);
    border-color:var(--red);
}

/* ---------- BOTONES ---------- */
.btn{
    padding:12px 22px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    margin:6px;
    transition:.25s;
}

.btn-red{ background:var(--red); color:white; }
.btn-blue{ background:var(--blue); color:white; }

.btn:hover{
    transform:scale(1.05);
    opacity:.9;
}

/* ---------- LOGIN ---------- */
.login-box{
    background:white;
    padding:30px;
    border-radius:18px;
    width:100%;
    max-width:900px;
    box-shadow:var(--shadow);
    text-align:center;
}

.login-box h2{
    margin-top:0;
    letter-spacing:1px;
}

input{
    width:85%;
    padding:12px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:15px;
}

/* ---------- ADMIN ---------- */
.console-log{
    background:#000;
    color:#0f0;
    font-family:monospace;
    padding:15px;
    height:220px;
    overflow-y:auto;
    border-radius:10px;
    font-size:13px;
    margin:20px 0;
    border:2px solid #222;
}

.admin-grid{
    display:flex;
    gap:25px;
    flex-wrap:wrap;
    justify-content:center;
}

.admin-box{
    flex:1;
    min-width:320px;
    background:#fafafa;
    padding:20px;
    border-radius:15px;
    box-shadow:var(--shadow);
}

.admin-box h3{
    margin-top:0;
    color:var(--red);
}

/* ---------- IFRAME ---------- */
#iframe-container{
    display:none;
    width:100%;
    height:100vh;
    background:black;
}

iframe{
    width:100%;
    height:100%;
    border:none;
}

/* ---------- BOT√ìN FLOTANTE ---------- */
.back-floating{
    position:fixed;
    bottom:20px;
    left:20px;
    z-index:9999;
    background:var(--dark);
    color:white;
    border:none;
    padding:12px 18px;
    border-radius:50px;
    cursor:pointer;
    box-shadow:var(--shadow);
    transition:.25s;
}

.back-floating:hover{
    background:var(--red);
}
</style>

    </style>
</head>
<body>

<button id="btnVolver" class="back-floating" style="display:none;" onclick="location.reload()">üè† Salir al Men√∫</button>

<section id="scr-portal" class="screen active" style="background:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)),url('https://media.licdn.com/dms/image/v2/C4E1BAQEwhNszm6dW-Q/company-background_10000/company-background_10000/0/1613591908640/filsa_cover?e=2147483647&v=beta&t=3nbyI94DarGf84BJMd5Tyye0Gbwuj0FEXHRgUwaDlKI');background-size:cover;">
    <img src="https://www.cofisatam.com.mx/img/portfolio/filsa.jpg" width="180" style="border-radius:10px; margin-bottom:15px;">
    <h1 style="color:white; letter-spacing: 2px;">SISTEMA DE INVENTARIADO</h1>
    <div class="card-container">
        <div class="card" onclick="preLogin()">
            <h1>üë§</h1>
            <h3>ADMIN</h3>
        </div>
        <div class="card" onclick="showScreen('scr-select-inv')">
            <h1>üìù</h1>
            <h3>INVENTARIOS</h3>
        </div>
    </div>
</section>

<section id="scr-select-inv" class="screen" style="background:#2c3e50;">
    <h2 style="color:white;">M√≥dulos de Inventario</h2>
    <div class="card-container">
        <div class="card" onclick="alert('M√≥dulo de ALMAC√âN en construcci√≥n...')">
            <h1>üè≠</h1>
            <h3>ALMAC√âN</h3>
        </div>
        <div class="card" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/', 'Cajas')">
            <h1>üì¶</h1>
            <h3>CAJAS</h3>
        </div>
        <div class="card" onclick="alert('M√≥dulo de BAS√çLICA en construcci√≥n...')">
            <h1>‚õ™</h1>
            <h3>BAS√çLICA</h3>
        </div>
        <div class="card" onclick="alert('M√≥dulo de BODEGA PT en construcci√≥n...')">
            <h1>üè¨</h1>
            <h3>BODEGA PT</h3>
        </div>
    </div>
    <button class="btn" style="background:#555;color:white;margin-top:20px;" onclick="showScreen('scr-portal')">VOLVER</button>
</section>

<section id="scr-login" class="screen">
    <div class="login-box" style="max-width:350px;">
        <h2>Acceso Restringido</h2>
        <input type="email" id="user-email" placeholder="Usuario Admin">
        <input type="password" id="user-pass" placeholder="Contrase√±a">
        <button class="btn btn-red" onclick="procesarLogin()">ENTRAR</button>
        <button class="btn" onclick="showScreen('scr-portal')">CANCELAR</button>
    </div>
</section>

<section id="scr-admin-panel" class="screen">
    <div class="login-box">
        <h2 style="color:var(--red); margin:0;">MODO ADMINISTRADOR</h2>
        
        <div class="console-log" id="consola-logs">> Cargando logs del servidor...</div>
        
        <div style="display:flex; gap:20px; flex-wrap: wrap; justify-content: center;">
            <div style="flex:1; min-width:300px; background:#f9f9f9; padding:15px; border-radius:10px;">
                <h3>üõ† Modificar Inventarios</h3>
                <p><small>Apertura forzada para edici√≥n:</small></p>
                <button class="btn btn-blue" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/', 'EDIT-CAJAS')">EDITAR CAJAS</button>
                <button class="btn btn-blue" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/', 'EDIT-BASILICA')">EDITAR BAS√çLICA</button>
                <button class="btn btn-blue" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/', 'EDIT-BODEGA')">EDITAR BODEGA PT</button>
                <button class="btn btn-blue" onclick="lanzarApp('https://santisgallegos123-rgb.github.io/FILSA/', 'EDIT-ALMACEN')">EDITAR ALMAC√âN</button>
            </div>

            <div style="flex:1; min-width:300px; background:#f9f9f9; padding:15px; border-radius:10px;">
                <h3>üë§ Gesti√≥n de Usuarios</h3>
                <input type="email" id="new-email" placeholder="Email nuevo admin">
                <input type="password" id="new-pass" placeholder="Password temporal">
                <button class="btn btn-red" onclick="crearNuevoAdmin()">REGISTRAR ADMIN</button>
            </div>
        </div>

        <button class="btn" style="background:#333; color:white; margin-top:15px;" onclick="location.reload()">CERRAR SESI√ìN</button>
    </div>
</section>

<div id="iframe-container">
    <iframe id="filsa-frame"></iframe>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB8wVMIhqa9OAFJCt3bzqouip2ICtqJkNQ",
        authDomain: "almacen-cajas-filsa.firebaseapp.com",
        databaseURL: "https://almacen-cajas-filsa-default-rtdb.firebaseio.com",
        projectId: "almacen-cajas-filsa",
        storageBucket: "almacen-cajas-filsa.firebasestorage.app",
        messagingSenderId: "1027121761492",
        appId: "1:1027121761492:web:6d892a43ade34e4117bf41"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('iframe-container').style.display = 'none';
        if (id !== 'none') document.getElementById(id).classList.add('active');
    }

    function preLogin() { showScreen('scr-login'); }

    function registrarAccion(usuario, accion) {
        const timestamp = new Date().toLocaleString();
        db.ref('logs_actividad').push({
            usuario: usuario,
            accion: accion,
            fecha: timestamp
        });
    }

    function procesarLogin() {
        const email = document.getElementById('user-email').value;
        const pass = document.getElementById('user-pass').value;

        auth.signInWithEmailAndPassword(email, pass)
            .then(() => {
                registrarAccion(email, "INGRESO A PANEL ADMIN");
                cargarConsola();
                showScreen('scr-admin-panel');
            })
            .catch(e => alert("Error de acceso: " + e.message));
    }

    function cargarConsola() {
        const consoleDiv = document.getElementById('consola-logs');
        db.ref('logs_actividad').limitToLast(20).on('value', (snapshot) => {
            consoleDiv.innerHTML = "";
            snapshot.forEach((child) => {
                const log = child.val();
                consoleDiv.innerHTML += `<div>[${log.fecha}] <b>${log.usuario}</b>: ${log.accion}</div>`;
            });
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        });
    }

    function lanzarApp(url, modulo) {
        const user = auth.currentUser ? auth.currentUser.email : "Usuario Externo";
        registrarAccion(user, "ACCESO A M√ìDULO: " + modulo);
        
        showScreen('none');
        document.getElementById('filsa-frame').src = url;
        document.getElementById('iframe-container').style.display = 'block';
        document.getElementById('btnVolver').style.display = 'block';
    }

    function crearNuevoAdmin() {
        const email = document.getElementById('new-email').value;
        const pass = document.getElementById('new-pass').value;
        if(!email || !pass) return alert("Llene todos los campos");

        auth.createUserWithEmailAndPassword(email, pass)
            .then(() => {
                registrarAccion(auth.currentUser.email, "CRE√ì NUEVO ADMIN: " + email);
                alert("Usuario " + email + " creado con √©xito.");
                document.getElementById('new-email').value = "";
                document.getElementById('new-pass').value = "";
            })
            .catch(e => alert(e.message));
    }
</script>

</body>
</html>